<div class="page-container">
  <h2><i class="pi pi-microchip-ai"></i> AI Recommendation</h2>

  <!-- AI Keys Table -->
  <div class="section">
    <h3>AI Configuration</h3>
    <p-table [value]="aiKeys" styleClass="p-datatable-sm">
      <ng-template pTemplate="header">
        <tr>
          <th>Name</th>
          <th>Key</th>
          <th>Prompt</th>
          <th style="width:80px">Actions</th>
        </tr>
      </ng-template>
      <ng-template pTemplate="body" let-key>
        <tr>
          <td>{{ key.name }}</td>
          <td class="password-mask">{{ maskKey(key.key) }}</td>
          <td [title]="key.prompt">{{ key.prompt?.length > 50 ? key.prompt.substring(0, 50) + '...' : key.prompt }}</td>
          <td>
            <button pButton icon="pi pi-pencil" class="p-button-text p-button-sm"
                    (click)="openEdit(key)" *ngIf="auth.hasPermission('edit_key')"></button>
          </td>
        </tr>
      </ng-template>
    </p-table>
  </div>

  <!-- Use AI Section -->
  <div class="section ai-section">
    <button pButton label="Use AI" icon="pi pi-bolt" (click)="useAi()"
            [loading]="aiLoading" class="ai-btn"></button>

    <div *ngIf="aiResponse" class="ai-response">
      <h3>AI Response</h3>
      <textarea pInputTextarea [value]="aiResponse" [rows]="10" readonly
                class="response-area"></textarea>
    </div>
  </div>
</div>

<!-- Edit AI Key Dialog -->
<p-dialog header="Edit AI Key" [(visible)]="showEditDialog" [modal]="true" [style]="{ width: '550px' }" (onShow)="onDialogShow()">
  <div class="dialog-form">
    <div class="field">
      <label>API Key</label>
      <input #aiKeyInput type="password" pInputText [(ngModel)]="editKeyValue" placeholder="Enter API key" />
    </div>
    <div class="field">
      <label>Prompt</label>
      <textarea pInputTextarea [(ngModel)]="editPrompt" [rows]="6" placeholder="AI prompt template"></textarea>
    </div>
  </div>
  <ng-template pTemplate="footer">
    <button pButton label="Cancel" icon="pi pi-times" class="p-button-text" (click)="showEditDialog = false"></button>
    <button pButton label="Save" icon="pi pi-check" (click)="saveKey()"></button>
  </ng-template>
</p-dialog>
